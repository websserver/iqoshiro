<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>IQOS AR Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/three@0.137.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.137.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-three.prod.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #container {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
      }
      #debug {
        position: fixed;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        font-size: 16px;
        text-align: center;
        z-index: 1000;
        max-width: 90%;
        white-space: nowrap;
        -webkit-backdrop-filter: blur(5px);
        backdrop-filter: blur(5px);
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }
      #controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 10px;
        font-family: Arial, sans-serif;
        text-align: center;
        z-index: 1000;
      }
      #slide-controls {
        position: fixed;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 1000;
        pointer-events: none;
      }
      .slide-button {
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        padding: 15px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 24px;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: auto;
        -webkit-tap-highlight-color: transparent;
      }
      #slide-counter {
        position: fixed;
        top: 120px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-family: Arial, sans-serif;
        z-index: 1000;
      }
      .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
      .loading div {
        color: white;
        font-family: Arial, sans-serif;
        font-size: 1.25em;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <div id="debug">Estado: Inicializando...</div>
    <div id="controls">ðŸ‘† Arraste para mover o modelo</div>
    <div id="slide-controls">
      <button class="slide-button" id="prev-model">â—€</button>
      <button class="slide-button" id="next-model">â–¶</button>
    </div>
    <div id="slide-counter">Modelo 1/3</div>
    <div class="loading"><div>A carregar, por favor aguarde...</div></div>

    <script>
      const start = async () => {
        const debugDiv = document.getElementById('debug');
        const loading = document.querySelector('.loading');
        const slideCounter = document.getElementById('slide-counter');
        const prevButton = document.getElementById('prev-model');
        const nextButton = document.getElementById('next-model');

        debugDiv.textContent = "Estado: Iniciando...";

        // ConfiguraÃ§Ã£o do MindAR
        const mindarThree = new window.MINDAR.IMAGE.MindARThree({
          container: document.querySelector("#container"),
          imageTargetSrc: "./markers/targets.mind",
          uiScanning: false,
        });
        const { renderer, scene, camera } = mindarThree;

        // ConfiguraÃ§Ã£o da iluminaÃ§Ã£o
        const light = new THREE.AmbientLight(0xffffff, 1.0);
        scene.add(light);

        // Array para armazenar os modelos
        const models = [];
        let currentModelIndex = 0;

        // FunÃ§Ã£o para carregar modelo
        const loadModel = (url) => {
          return new Promise((resolve, reject) => {
            const loader = new THREE.GLTFLoader();
            loader.load(url,
              (gltf) => {
                const model = gltf.scene;
                model.scale.set(5, 5, 5);
                model.position.set(0, 0.1, 0);
                model.visible = false;
                resolve(model);
              },
              undefined,
              reject
            );
          });
        };

        // Carrega todos os modelos
        try {
          debugDiv.textContent = "Estado: Carregando modelos...";
          const modelUrls = [
            "modelo3d/modelo.glb",
            "modelo3d/modelo2.glb",
            "modelo3d/modelo3.glb"
          ];

          const anchor = mindarThree.addAnchor(0);
          
          for (let i = 0; i < modelUrls.length; i++) {
            const model = await loadModel(modelUrls[i]);
            models.push(model);
            anchor.group.add(model);
          }

          // Mostra o primeiro modelo
          models[0].visible = true;
          debugDiv.textContent = "Estado: Modelos carregados!";
        } catch (error) {
          console.error("Erro ao carregar modelos:", error);
          debugDiv.textContent = "Estado: Erro ao carregar modelos!";
        }

        // FunÃ§Ã£o para trocar modelo
        const trocarModelo = (direcao) => {
          // Esconde o modelo atual
          models[currentModelIndex].visible = false;

          // Atualiza o Ã­ndice
          if (direcao === 'next') {
            currentModelIndex = (currentModelIndex + 1) % models.length;
          } else {
            currentModelIndex = (currentModelIndex - 1 + models.length) % models.length;
          }

          // Mostra o novo modelo
          models[currentModelIndex].visible = true;
          
          // Atualiza o contador
          slideCounter.textContent = `Modelo ${currentModelIndex + 1}/${models.length}`;
          debugDiv.textContent = `Estado: Modelo ${currentModelIndex + 1} ativo`;
        };

        // Eventos dos botÃµes
        prevButton.addEventListener('click', () => trocarModelo('prev'));
        nextButton.addEventListener('click', () => trocarModelo('next'));

        // Eventos de toque para arrastar
        let isDragging = false;
        let previousTouch;

        document.addEventListener('touchstart', (e) => {
          isDragging = true;
          previousTouch = e.touches[0];
        });

        document.addEventListener('touchmove', (e) => {
          if (!isDragging) return;

          const touch = e.touches[0];
          const deltaX = touch.clientX - previousTouch.clientX;
          const deltaY = touch.clientY - previousTouch.clientY;

          const currentModel = models[currentModelIndex];
          if (currentModel && currentModel.visible) {
            currentModel.position.x += deltaX * 0.01;
            currentModel.position.y -= deltaY * 0.01;
          }

          previousTouch = touch;
        });

        document.addEventListener('touchend', () => {
          isDragging = false;
        });

        // Inicia o MindAR
        await mindarThree.start();
        loading.style.display = "none";
        debugDiv.textContent = "Estado: Procurando marcador...";

        // Loop de renderizaÃ§Ã£o
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
      };

      // Inicia a aplicaÃ§Ã£o quando o DOM estiver carregado
      window.addEventListener('DOMContentLoaded', start);
    </script>
  </body>
</html> 